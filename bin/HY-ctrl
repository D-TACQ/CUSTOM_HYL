#!/usr/bin/env expect
# HY-stat reports current status file

log_user 0
set FNC /dev/shm/HY-comm
set FNS /dev/shm/HY-stat


spawn inotifywait -m -e close_write -q $FNC



while { 1 } {
	expect {
		"$FNC*\n" {
			set fp [open $FNS w]
			puts $fp [read [open $FNC r]]
			close $fp
			send_user "[read [open $FNC r]]\rHY-ctrl>"
		}
                -i $user_spawn_id -re "\n" {
			send_user "[read [open $FNC r]]\rHY-ctrl>"
		}
	}
}

